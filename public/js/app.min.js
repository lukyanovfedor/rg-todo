!function(t,r,e){"use strict";var o=e.module("todo",["ui.router","ui.bootstrap","ui.sortable"]);o.config(["$stateProvider","$urlRouterProvider",function(t,r){t.state("auth",{url:"/auth",templateUrl:"auth.html",controller:"AuthCtrl",resolve:{access:["Auth",function(t){return t.check()}]},onEnter:["access","$injector",function(t,r){t.loggedIn&&r.get("$state").go("projects")}]}).state("projects",{url:"/projects",templateUrl:"projects.html",controller:"ProjectsCtrl",controllerAs:"projCtrl",resolve:{my:["Project",function(t){return t.getMy()}],user:["Auth",function(t){return t.getUser()}]}}),r.otherwise("/projects")}]),o.config(["$httpProvider",function(t){t.interceptors.push(["$q","$injector",function(t,r){return{responseError:function(e){if(e.status&&401===e.status)r.get("$state").go("auth");else{var o=e.data&&e.data.error?e.data.error:e.statusText;r.get("Notify").add({type:"error",text:o})}return t.reject(e)}}}])}])}(window,document,window.angular);
!function(t,i,o){"use strict";function n(t,i){var o=this;o.loginData={email:"",password:""},o.registerData={email:"",password:"",rePassword:""},o.login=function(n){return n.$invalid?void(n.submitted=!0):void t.login(o.loginData).then(function(){i.go("projects")})},o.register=function(n){return n.$invalid?void(n.submitted=!0):void t.register(o.registerData).then(function(){i.go("projects")})}}var r=o.module("todo");r.controller("AuthCtrl",["Auth","$state",n])}(window,document,window.angular);
!function(t,o,n){"use strict";function u(t,o,n){var u=this;u.notify=t,u.logout=function(){o.logout().then(function(){n.go("auth")})}}var i=n.module("todo");i.controller("mainCtrl",["Notify","Auth","$state",u])}(window,document,window.angular);
!function(e,t,n){"use strict";function s(e,t,n,s){var o=this,a=function(e,t){n.saveOrder(e,t)};o.my=function(){var s={};s.projects=[],s.tasks={},e.projects.forEach(function(e){s.tasks[e.id]=[],s.projects.push(new t(e.id,e))});for(var o in e.tasks)Object.prototype.hasOwnProperty.call(e.tasks,o)&&e.tasks[o]&&e.tasks[o].length&&e.tasks[o].forEach(function(e){s.tasks[o].push(new n(e.id,e))});return s}(),o.user=s,o.create={project:function(){var e=["Give me a name"],n=Math.floor(Math.random()*e.length);t.create({name:e[n]}).then(function(e){o.my.projects.push(new t(e.id,e)),o.my.tasks[e.id]=[]})},task:function(e,t){return e.taskName.$modelValue&&e.taskName.$modelValue.length?void n.create(t,e.newTask).then(function(s){var r=[];e.newTask="",e.$setPristine(!0),e.submitted=!1,o.my.tasks[t].length||(o.my.tasks[t]=[]),o.my.tasks[t].unshift(new n(s.id,s)),o.my.tasks[t].forEach(function(e){r.push(e.id)}),a(r,t)}):void(e.submitted=!0)}},o["delete"]={project:function(e){e["delete"]().then(function(){delete o.my.tasks[e.id];var t=o.my.projects.indexOf(e);t>-1&&o.my.projects.splice(t,1)})},task:function(e){e["delete"]().then(function(){var t=o.my.tasks[e.projectId],n=t.indexOf(e);n>-1&&t.splice(n,1)})}},o.deadlineOpt={"show-weeks":!1},o.dndHandlers={accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id},orderChanged:function(e){var t=e.dest.sortableScope.modelValue,n=t[e.dest.index],s=[];t.forEach(function(e){s.push(e.id)}),a(s,n.projectId)}}}var o=n.module("todo");o.controller("ProjectsCtrl",["my","Project","Task","user",s])}(window,document,window.angular,window.moment);
!function(e,t,i){"use strict";var n=i.module("todo");n.directive("autoEdit",["$timeout",function(e){return{restrict:"E",templateUrl:function(e,t){return"input"===t.type?"directives/autoInput.html":"directives/autoContent.html"},replace:!0,scope:{model:"=model",field:"@field",editable:"=editable",save:"@save"},link:function(t,i){var n,o=i.find("*"),l=t.model[t.field],d=function(){t.model[t.field].length&&(n&&e.cancel(n),n=e(function(){t.model[t.save](),l=t.model[t.field]},350))};t.$watch("editable",function(e){e?o[0].focus():t.model[t.field].length||(t.model[t.field]=l)}),"function"==typeof t.model[t.save]&&o.on("input",d)}}}])}(window,document,angular);
!function(e,t,n){"use strict";var r=n.module("todo");r.directive("contenteditable",["$timeout",function(r){return{restrict:"A",require:"?ngModel",link:function(a,i,l,o){if(o){var c={};n.forEach(["stripBr","noLineBreaks","selectNonEditable","moveCaretToEndOnChange"],function(e){var t=l[e];c[e]=t&&"false"!==t}),i.bind("input",function(){a.$apply(function(){var e,t,n;e=i.html(),n=!1,c.stripBr&&(e=e.replace(/<br>$/,"")),c.noLineBreaks&&(t=e.replace(/<div>/g,"").replace(/<br>/g,"").replace(/<\/div>/g,""),t!==e&&(n=!0,e=t)),o.$setViewValue(e),n&&o.$render(),""===e&&r(function(){i[0].blur(),i[0].focus()})})});var d=o.$render;o.$render=function(){var n,r,a,l;d&&d(),i.html(o.$viewValue||""),c.moveCaretToEndOnChange&&(n=i[0],a=t.createRange(),l=e.getSelection(),n.childNodes.length>0?(r=n.childNodes[n.childNodes.length-1],a.setStartAfter(r)):a.setStartAfter(n),a.collapse(!0),l.removeAllRanges(),l.addRange(a))},c.selectNonEditable&&i.bind("click",function(r){var a,i,l;l=r.toElement,l!==this&&"false"===n.element(l).attr("contenteditable")&&(a=t.createRange(),i=e.getSelection(),a.setStartBefore(l),a.setEndAfter(l),i.removeAllRanges(),i.addRange(a))})}}}}])}(window,document,angular);
!function(e,t,r,o){"use strict";function n(e,t){var r=function(e,t){this.id=parseInt(e,10)||0,o.isObject(t)&&this.setFields(t)};return r.prototype.setFields=function(e){var t={name:"string",ownerId:"number"};for(var r in e)Object.prototype.hasOwnProperty.call(t,r)&&(this[r]=e[r]);return this},r.prototype.update=function(){var r=t.defer();return e.put("/projects/"+this.id,this).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},r.prototype["delete"]=function(){var r=t.defer();return e["delete"]("projects/"+this.id).success(function(){r.resolve()}).error(function(e){r.reject(e)}),r.promise},r.getMy=function(){var r=t.defer();return e.get("/projects").success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},r.create=function(r){var o=t.defer();return e.post("/projects",r).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},r}var s=r.module("todo");s.factory("Project",["$http","$q",n])}(window,document,window.angular,window.whatType);
!function(t,e,r,o){"use strict";function s(t,e){var r=function(t,e){this.id=e.id||0,whatType.isObject(e)&&this.setFields(e)};return r.prototype.setFields=function(t){var e={name:"string",projectId:"number",status:"number",deadline:"string",order:"string"};for(var r in t)Object.prototype.hasOwnProperty.call(e,r)&&(this[r]=t[r]);return this},r.create=function(r,o){var s=e.defer();return t.post("/tasks",{projectId:r,name:o}).success(function(t){s.resolve(t)}).error(function(t){s.reject(t)}),s.promise},r.saveOrder=function(r,o){var s=e.defer();return t.post("/tasks/order",{order:r,projectId:o}).success(function(t){s.resolve(t)}).error(function(t){s.reject(t)}),s.promise},r.prototype.update=function(){var r=e.defer();return t.put("/tasks/"+this.id,this).success(function(t){r.resolve(t)}).error(function(t){r.reject(t)}),r.promise},r.prototype["delete"]=function(){var r=e.defer();return t["delete"]("/tasks/"+this.id).success(function(t){r.resolve(t)}).error(function(t){r.reject(t)}),r.promise},r.prototype.statusToggler=function(){this.status=1===this.status?0:1,that.update()},r.prototype.setDeadline=function(t){this.deadline=t?o(t).format("YYYY-MM-DD HH:MM:SS"):"",this.update()},r}var n=r.module("todo");n.factory("Task",["$http","$q",s])}(window,document,window.angular,window.moment);
!function(e,r,t){"use strict";function o(e,r){var t={};return t.login=function(t){var o=r.defer();return e.post("/auth/login",t).success(function(){o.resolve()}).error(function(e){o.reject(e)}),o.promise},t.register=function(t){var o=r.defer();return e.post("/auth/register",t).success(function(){o.resolve()}).error(function(e){o.reject(e)}),o.promise},t.check=function(){var t=r.defer();return e.get("/auth").success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise},t.logout=function(){var t=r.defer();return e.post("/auth/logout").success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise},t.getUser=function(){var t=r.defer();return e.get("/users").success(function(e){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise},t}var n=t.module("todo");n.service("Auth",["$http","$q",o])}(window,document,window.angular);
!function(r,t,e){"use strict";function n(r){var t,n={},o=[],i=[],u={error:{title:"Error",text:"Oops, something wrong!",time:3e3}};return n.getCurrent=function(){return o},n.hasCurrent=function(){return o.length},n.add=function(f){var c={};if(console.log(f),e.isObject(f)){if(!f.type||!u[f.type])throw Error("Miss require argument of function");e.extend(c,u[f.type],f)}else{if(!e.isString(f))throw Error("Miss require argument of function");if(c=u[f],!c)throw Error("Wrong argument")}return o.length?i.push(c):(o.push(c),void(t=r(function(){n.removeCurrent()},c.time)))},n.removeCurrent=function(){if(r.cancel(t),o=[],i.length){var e=Array.prototype.shift.call(i);n.add(e)}},n}var o=e.module("todo");o.factory("Notify",["$timeout",n])}(window,document,angular);
angular.module("todo").run(["$templateCache",function(r){r.put("auth.html",'<div ng-controller="AuthCtrl as auth" class="auth rounded shadowed">\n	<form ng-submit="auth.login(loginForm)" class="login" name="loginForm" novalidate="true">\n\n		<div class="form-group"\n			ng-class="{\'has-error\': !loginForm.lemail.$valid && loginForm.submitted}">\n			<input type="email" required name="lemail" class="form-control" placeholder="Enter email" ng-model="auth.loginData.email">\n\n			<div ng-if="loginForm.submitted && !loginForm.lemail.$valid">\n				<div ng-if="loginForm.lemail.$error.email" class="help-block">Wrong email</div>\n				<div ng-if="loginForm.lemail.$error.required" class="help-block">Enter email</div>\n			</div>\n		</div>\n\n		<div class="form-group"\n			ng-class="{\'has-error\': !loginForm.lpassword.$valid && loginForm.submitted}">\n			<input type="password" required name="lpassword" class="form-control" placeholder="Password" ng-model="auth.loginData.password"\n				ng-pattern="/^[a-zA-Z0-9]*$/" ng-trim="false">\n\n			<div ng-if="loginForm.submitted && !loginForm.lpassword.$valid">\n				<div ng-if="loginForm.lpassword.$error.required" class="help-block">Enter password</div>\n				<div ng-if="loginForm.lpassword.$error.pattern" class="help-block">Password must be alphanumeric</div>\n			</div>\n		</div>\n\n		<button type="submit" class="btn btn-primary">Sign In</button>\n	</form>\n\n	<div class="or">\n		<span>or if u don\'t have an account</span>\n	</div>\n\n	<form ng-submit="auth.register(registerForm)" class="register" name="registerForm" novalidate="true">\n		<div class="form-group"\n			ng-class="{\'has-error\': !registerForm.remail.$valid && registerForm.submitted}">\n			<input type="email" required name="remail" class="form-control" placeholder="Email" ng-model="auth.registerData.email">\n\n			<div ng-if="registerForm.submitted && !registerForm.remail.$valid">\n				<div ng-if="registerForm.remail.$error.email" class="help-block">Wrong email</div>\n				<div ng-if="registerForm.remail.$error.required" class="help-block">Enter email</div>\n			</div>\n		</div>\n\n		<div class="form-group"\n			ng-class="{\'has-error\': !registerForm.rpassword.$valid && registerForm.submitted}">\n			<input type="password" required name="rpassword" class="form-control" placeholder="Password" ng-model="auth.registerData.password"\n				ng-pattern="/^[a-zA-Z0-9]*$/" ng-trim="false">\n\n			<div ng-if="registerForm.submitted && !registerForm.rpassword.$valid">\n				<div ng-if="registerForm.rpassword.$error.required" class="help-block">Enter password</div>\n				<div ng-if="registerForm.rpassword.$error.pattern" class="help-block">Password must be alphanumeric</div>\n			</div>\n		</div>\n\n		<div class="form-group"\n			ng-class="{\'has-error\': !registerForm.rpassword2.$valid && registerForm.submitted}">\n			<input type="password" required name="rpassword2" class="form-control" placeholder="Retype password"\n				ng-model="auth.registerData.rePassword" ng-pattern="/^[a-zA-Z0-9]*$/" ng-trim="false">\n\n			<div ng-if="registerForm.submitted && !registerForm.rpassword2.$valid">\n				<div ng-if="registerForm.rpassword2.$error.required" class="help-block">Enter password</div>\n				<div ng-if="registerForm.rpassword2.$error.pattern" class="help-block">Password must be alphanumeric</div>\n			</div>\n		</div>\n\n		<button type="submit" class="btn btn-success">Sign Up</button>\n	</form>\n</div>')}]);
angular.module("todo").run(["$templateCache",function(n){n.put("projects.html",'<div class="projects">\n	<div class="current-user">\n		<div dropdown is-open="status.isopen">\n			<div class="avatar" dropdown-toggle>\n				<img src="{{projCtrl.user.avatar}}" alt="">\n			</div>\n\n			<ul class="dropdown-menu" role="menu">\n				<li><a href="" ng-click="main.logout()">Logout</a></li>\n			</ul>\n		</div>\n	</div>\n\n	<div class="single-project"\n		ng-repeat="p in projCtrl.my.projects"\n		ng-init="editProject = false">\n\n		<div class="project-title">\n			<div class="list-icon">\n				<i class="glyphicon glyphicon-list-alt"></i>\n			</div>\n\n			<auto-edit class="project-name" type="input" model="p" field="name" editable="editProject" save="update"></auto-edit>\n\n			<div class="control">\n				<a href="" ng-click="editProject = !editProject" class="edit-project" title="Edit project">\n					<i class="glyphicon glyphicon-pencil"></i>\n				</a>\n\n				<span class="separator"></span>\n\n				<a href="" ng-click="projCtrl.delete.project(p)" class="delete-project" title="Remove project">\n					<i class="glyphicon glyphicon-trash"></i>\n				</a>\n			</div>\n		</div>\n\n		<div class="add-task">\n			<div class="plus-icon">\n				<i class="glyphicon glyphicon-plus"></i>\n			</div>\n\n			<form class="control clearfix" name="addTaskForm" ng-submit="projCtrl.create.task(addTaskForm, p.id)">\n				<input type="text" ng-class="{error: !addTaskForm.taskName.$valid && (addTaskForm.taskName.$dirty || addTaskForm.submitted)}"\n					placeholder="Start typing here to create a task..." ng-model="addTaskForm.newTask" name="taskName" required />\n\n				<a href="" ng-click="projCtrl.create.task(addTaskForm, p.id)" class="trans-opacity">Add Task</a>\n			</form>\n		</div>\n\n		<ul class="tasks list-unstyled"\n			ng-if="projCtrl.my.tasks[p.id].length"\n			ng-model="projCtrl.my.tasks[p.id]"\n			as-sortable="projCtrl.dndHandlers">\n\n			<li class="single-task"\n				ng-repeat="t in projCtrl.my.tasks[p.id]"\n				as-sortable-item\n				ng-class="{done: t.status}"\n				ng-init="editTask = false;">\n\n				<div class="dnd" as-sortable-item-handle>\n					<div class="complete">\n						<a href="" ng-click="t.statusToggler()"></a>\n					</div>\n\n					<div class="sep"></div>\n\n					<auto-edit class="task-name" type="content" model="t" field="name" editable="editTask" save="update"></auto-edit>\n\n					<div class="control">\n						<span class="deadline">\n							<i class="glyphicon glyphicon-calendar"\n								ng-click="open = !open"\n								datepicker-popup="yyyy-MM-dd"\n								ng-model="t.deadline"\n								is-open="open"\n								datepicker-options="projCtrl.deadlineOpt"\n								ng-change="t.setDeadline(t.deadline);">\n							</i>\n						</span>\n\n						<span class="sep"></span>\n\n						<a href="" ng-click="editTask = !editTask" class="edit-task">\n							<i class="glyphicon glyphicon-pencil"></i>\n						</a>\n\n						<span class="sep"></span>\n\n						<a href="" ng-click="projCtrl.delete.task(t)" class="delete-task">\n							<i class="glyphicon glyphicon-trash"></i>\n						</a>\n					</div>\n				</div>\n			</li>\n		</ul>\n	</div>\n\n	<div ng-if="!projCtrl.my.projects.length" class="empty rounded shadowed">\n		You do not have any projects yet.<br /> Try to create\n\n		<div class="empty-icon"></div>\n	</div>\n\n	<a href="" class="add-project trans-bg-color" ng-click="projCtrl.create.project()">\n		<i class="glyphicon glyphicon-plus"></i>\n		Add TODO List\n	</a>\n</div>')}]);
angular.module("todo").run(["$templateCache",function(e){e.put("directives/autoContent.html",'<div class="auto-edit" ng-class="{editable: editable, error: !model[field].length}">\n	<div contenteditable="{{editable}}" strip-br="true" no-line-breaks="true" move-caret-to-end-on-change="true" ng-model="model[field]"></div>\n</div>')}]);
angular.module("todo").run(["$templateCache",function(e){e.put("directives/autoInput.html",'<div class="auto-edit" ng-class="{editable: editable, error: !model[field].length}">\n	<input type="text" ng-model="model[field]" ng-disabled="!editable">\n</div>')}]);